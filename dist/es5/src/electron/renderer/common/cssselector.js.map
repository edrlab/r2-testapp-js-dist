{"version":3,"file":"cssselector.js","sourceRoot":"","sources":["../../../../../../src/electron/renderer/common/cssselector.ts"],"names":[],"mappings":"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","sourcesContent":["// tslint:disable-next-line:max-line-length\n// https://github.com/fczbkk/css-selector-generator-benchmark/blob/master/README.md#chromiums-dompresentationutils\n\n// tslint:disable-next-line:max-line-length\n// https://chromium.googlesource.com/chromium/blink/+/master/Source/devtools/front_end/components/DOMPresentationUtils.js#259\nexport const fullQualifiedSelector = (node: Node, justSelector: boolean): string => {\n    if (node.nodeType !== Node.ELEMENT_NODE) {\n        const lowerCaseName = (node.localName && node.localName.toLowerCase()) || node.nodeName.toLowerCase();\n        return lowerCaseName;\n    }\n    return cssPath(node, justSelector);\n};\n\ninterface IDOMNodePathStep {\n    optimized: boolean;\n    value: string;\n}\n\n// tslint:disable-next-line:max-line-length\n// https://chromium.googlesource.com/chromium/blink/+/master/Source/devtools/front_end/components/DOMPresentationUtils.js#289\nconst cssPath = (node: Node, optimized: boolean): string => {\n    if (node.nodeType !== Node.ELEMENT_NODE) {\n        return \"\";\n    }\n\n    const steps = [];\n    let contextNode = node;\n    while (contextNode) {\n        const step = _cssPathStep(contextNode, !!optimized, contextNode === node);\n        if (!step) {\n            break; // Error - bail out early.\n        }\n        steps.push(step.value);\n        if (step.optimized) {\n            break;\n        }\n        contextNode = contextNode.parentNode as Node;\n    }\n    steps.reverse();\n    return steps.join(\" > \");\n};\n\n// tslint:disable-next-line:max-line-length\n// https://chromium.googlesource.com/chromium/blink/+/master/Source/devtools/front_end/components/DOMPresentationUtils.js#316\nconst _cssPathStep = (node: Node, optimized: boolean, isTargetNode: boolean): IDOMNodePathStep | undefined => {\n\n    const prefixedElementClassNames = (nd: Element): string[] => {\n        const classAttribute = nd.getAttribute(\"class\");\n        if (!classAttribute) {\n            return [];\n        }\n\n        return classAttribute.split(/\\s+/g).filter(Boolean).map((nm) => {\n            // The prefix is required to store \"__proto__\" in a object-based map.\n            return \"$\" + nm;\n        });\n    };\n\n    const idSelector = (idd: string): string => {\n        return \"#\" + escapeIdentifierIfNeeded(idd);\n    };\n\n    const escapeIdentifierIfNeeded = (ident: string): string => {\n        if (isCSSIdentifier(ident)) {\n            return ident;\n        }\n\n        const shouldEscapeFirst = /^(?:[0-9]|-[0-9-]?)/.test(ident);\n        const lastIndex = ident.length - 1;\n        return ident.replace(/./g, (c: string, ii: number) => {\n            return ((shouldEscapeFirst && ii === 0) || !isCSSIdentChar(c)) ? escapeAsciiChar(c, ii === lastIndex) : c;\n        });\n    };\n\n    const escapeAsciiChar = (c: string, isLast: boolean) => {\n        return \"\\\\\" + toHexByte(c) + (isLast ? \"\" : \" \");\n    };\n\n    const toHexByte = (c: string): string => {\n        let hexByte = c.charCodeAt(0).toString(16);\n        if (hexByte.length === 1) {\n            hexByte = \"0\" + hexByte;\n        }\n        return hexByte;\n    };\n\n    const isCSSIdentChar = (c: string): boolean => {\n        if (/[a-zA-Z0-9_-]/.test(c)) {\n            return true;\n        }\n        return c.charCodeAt(0) >= 0xA0;\n    };\n\n    const isCSSIdentifier = (value: string): boolean => {\n        return /^-?[a-zA-Z_][a-zA-Z0-9_-]*$/.test(value);\n    };\n\n    if (node.nodeType !== Node.ELEMENT_NODE) {\n        return undefined;\n    }\n    const lowerCaseName = (node.localName && node.localName.toLowerCase()) || node.nodeName.toLowerCase();\n\n    const element = node as Element;\n\n    const id = element.getAttribute(\"id\");\n\n    if (optimized) {\n        if (id) {\n            return {\n                optimized: true,\n                value: idSelector(id),\n            };\n        }\n        if (lowerCaseName === \"body\" || lowerCaseName === \"head\" || lowerCaseName === \"html\") {\n            return {\n                optimized: true,\n                value: lowerCaseName, // node.nodeNameInCorrectCase(),\n            };\n        }\n    }\n\n    const nodeName = lowerCaseName; // node.nodeNameInCorrectCase();\n    if (id) {\n        return {\n            optimized: true,\n            value: nodeName + idSelector(id),\n        };\n    }\n\n    const parent = node.parentNode;\n\n    if (!parent || parent.nodeType === Node.DOCUMENT_NODE) {\n        return {\n            optimized: true,\n            value: nodeName,\n        };\n    }\n\n    const prefixedOwnClassNamesArray_ = prefixedElementClassNames(element);\n    const prefixedOwnClassNamesArray: string[] = []; // .keySet()\n    prefixedOwnClassNamesArray_.forEach((arrItem) => {\n        if (prefixedOwnClassNamesArray.indexOf(arrItem) < 0) {\n            prefixedOwnClassNamesArray.push(arrItem);\n        }\n    });\n\n    let needsClassNames = false;\n    let needsNthChild = false;\n    let ownIndex = -1;\n    let elementIndex = -1;\n    const siblings = (parent as Element).children;\n\n    for (let i = 0; (ownIndex === -1 || !needsNthChild) && i < siblings.length; ++i) {\n        const sibling = siblings[i];\n        if (sibling.nodeType !== Node.ELEMENT_NODE) {\n            continue;\n        }\n        elementIndex += 1;\n        if (sibling === node) {\n            ownIndex = elementIndex;\n            continue;\n        }\n        if (needsNthChild) {\n            continue;\n        }\n\n        // sibling.nodeNameInCorrectCase()\n        const siblingName = (sibling.localName && sibling.localName.toLowerCase()) || sibling.nodeName.toLowerCase();\n        if (siblingName !== nodeName) {\n            continue;\n        }\n        needsClassNames = true;\n\n        const ownClassNames: string[] = [];\n        prefixedOwnClassNamesArray.forEach((arrItem) => {\n            ownClassNames.push(arrItem);\n        });\n        let ownClassNameCount = ownClassNames.length;\n\n        if (ownClassNameCount === 0) {\n            needsNthChild = true;\n            continue;\n        }\n        const siblingClassNamesArray_ = prefixedElementClassNames(sibling);\n        const siblingClassNamesArray: string[] = []; // .keySet()\n        siblingClassNamesArray_.forEach((arrItem) => {\n            if (siblingClassNamesArray.indexOf(arrItem) < 0) {\n                siblingClassNamesArray.push(arrItem);\n            }\n        });\n\n        for (const siblingClass of siblingClassNamesArray) {\n            const ind = ownClassNames.indexOf(siblingClass);\n            if (ind < 0) {\n                continue;\n            }\n\n            ownClassNames.splice(ind, 1); // delete ownClassNames[siblingClass];\n\n            if (!--ownClassNameCount) {\n                needsNthChild = true;\n                break;\n            }\n        }\n    }\n\n    let result = nodeName;\n    if (isTargetNode &&\n        nodeName === \"input\" &&\n        element.getAttribute(\"type\") &&\n        !element.getAttribute(\"id\") &&\n        !element.getAttribute(\"class\")) {\n        result += \"[type=\\\"\" + element.getAttribute(\"type\") + \"\\\"]\";\n    }\n    if (needsNthChild) {\n        result += \":nth-child(\" + (ownIndex + 1) + \")\";\n    } else if (needsClassNames) {\n        for (const prefixedName of prefixedOwnClassNamesArray) {\n            result += \".\" + escapeIdentifierIfNeeded(prefixedName.substr(1));\n        }\n    }\n\n    return {\n        optimized: false,\n        value: result,\n    };\n};\n\n// tslint:disable-next-line:max-line-length\n// https://chromium.googlesource.com/chromium/blink/+/master/Source/devtools/front_end/components/DOMPresentationUtils.js#270\n// const simpleSelector = (node: Node): string => {\n//     const lowerCaseName = (node.localName && node.localName.toLowerCase()) || node.nodeName.toLowerCase();\n//     if (node.nodeType !== Node.ELEMENT_NODE) {\n//         return lowerCaseName;\n//     }\n\n//     const element = node as Element;\n\n//     const id = element.getAttribute(\"id\");\n//     if (id) {\n//         return lowerCaseName + \"#\" + id;\n//     }\n\n//     const clazz = element.getAttribute(\"class\");\n//     if (clazz) {\n//         return (lowerCaseName === \"div\" ? \"\" : lowerCaseName) + \".\" + clazz.trim().replace(/\\s+/g, \".\");\n//     }\n\n//     const typez = element.getAttribute(\"type\");\n//     if (typez && lowerCaseName === \"input\") {\n//         return lowerCaseName + \"[type=\\\"\" + typez + \"\\\"]\";\n//     }\n\n//     return lowerCaseName;\n// };\n"]}